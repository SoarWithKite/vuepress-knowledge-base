---
title: 计算机系统概述
date: 2020-05-11 13:59:38
permalink: /pages/52d5c3
article: false
---

# 第 1 章 计算机系统概述

## 1.操作系统的基本概念

### 1.1操作系统的概念、功能和目标（系统资源的管理者、提供接口、作为扩充机器、虚拟机）

#### 1 熟悉的操作系统举例

![image-20221101204902362](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101204902362.png)



#### 2 操作系统的层次结构

![image-20221101205213892](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101205213892.png)

#### 3 操作系统的概念

- 是系统最基本最核心的软件，属于系统软件
- 控制和管理整个计算机的硬件和软件资源
- 合理的组织、调度计算机的工作与资源的分配
- 为用户和其它软件提供方便的接口和环境

![image-20221101205557134](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101205557134.png)

![image-20221101210103705](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101210103705.png)

#### 4 操作系统的功能和目标

先放一张思维导图，大致知道操作系统的具体功能和目标，然后再一一展开叙述。

![image-20221101205557134](https://gitee.com/kiteflyer/picture/raw/master/OS/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD.png)

![image-20221101212907309](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101212907309.png)

用一个直观的例子来理解上述图中操作系统的功能：

> - 我们假设：用户是雇主，操作系统是工人（用来操作机器），计算机是机器（由处理机(CPU)、存储器、设备、文件几个部件构成）
> - 工人有熟练的技能去控制和协调各个部件的工作，这就是操作系统对资源的管理
> - 同时，工人必须接受雇主的命令，这就是“接口”
> - 有了工人，机器就能发挥更大的作用，因此工人就成了“扩充机器”
> - 工人操作机器、机器有了更大的作用比如GUI界面，于是工人便成了扩充机器，去扩充GUI界面等功能

##### （1）作为计算机系统资源的管理者

管理软硬件资源、合理的组织、调度计算机的工作与资源的分配

![image-20221101213118157](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101213118157.png)

###### 处理器（CPU管理）

在多道程序环境下，cpu的分配和运行都以进程（或线程）为基本单位，因此对cpu的管理可理解为对进程的管理。进程管理的主要功能包括`进程控制、进程同步、进程通信、死锁处理、处理机调度`等。附上一张图理解对进程的管理。

![image-20221101213951411](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101213951411.png)

###### 存储器管理

为多道程序的运行提供良好的环境，方便用户使用及提高内存的利用率，主要包括`内存分配与回收、地址映射、内存保护与共享和内存扩充`等功能。

![image-20221101214025036](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101214025036.png)

###### 文件管理

计算机中所有的信息都是以文件的形式存在的，操作系统中负责文件的管理的部分称为文件系统，文件管理包括`文件存储空间的管理、目录管理及文件读写管理和保护`等。

![image-20221101214057386](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101214057386.png)

###### 设备管理

设备管理的主要任务是完成用户的I/O请求，方便用户使用各种设备，并提高设备的利用率，主要`包括缓存管理、设备分配、设备处理和虚拟设备`等功能。

![image-20221101214247449](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101214247449.png)

以上4种管理功能都由“工人”负责，“雇主”无序关注。

##### （2）作为用户与计算机硬件系统之间的接口

> 向上层提供方便易用的服务

![image-20221101215814380](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101215814380.png)

- 为了让用户方便、快捷、可靠的操作计算机硬件并执行自己的程序，操作系统提供了用户接口
- 操作系统提供的接口分为两类：`命令接口和程序接口`
- `命令接口`：用户可以`直接`使用的，利用这些操作命令来组织和控制作业的执行
- `程序接口`：用户通过程序`间接`使用的，编程人员可以使用它们来请求操作系统服务

![image-20221101214503949](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101214503949.png)

###### 命令接口

- 命令接口分为两类：联机命令接口和脱机命令接口，用户可以`直接`调用
- `联机命令接口`：又称交互式命令接口，适用于分时或实时系统的接口，由一组键盘操作命令组成。用户输入一条指令，操作系统就执行一条指令；

![image-20221101215039952](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101215039952.png)

- `脱机命令接口`：又称批处理接口，使用于批处理系统，由一组作业控制命令组成。用户输入一堆指令，操作系统运行一堆指令。在操作系统运行这些命令时用户不可干预。

> 批处理(Batch)，也称为批处理脚本。顾名思义，批处理就是对某对象进行批量的处理，通常被认为是一种简化的脚本语言，它应用于DOS和Windows系统中。批处理文件的扩展名为bat 。
>
> ![image-20221101215123570](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101215123570.png)

###### 程序接口

- 程序接口：由一组`系统调用（也称广义指令）`组成
- 用户通过在程序中使用这些系统调用来请求操作系统为其提供服务，只能通过用户程序`间接`调用
- 如使用各种外部设备、申请分配和回收内存及其它各种要求

![image-20221101220023867](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101220023867.png)

> 程序接口:如 C: \Windows\System32\user32.dll程序员在程序中调用user32.dll（该调用过程即为系统调用）即可实现创建窗口等功能。只能通过用户程序间接使用。

`动态链接库英文为DLL，是Dynamic Link Library的缩写。DLL是一个包含可由多个程序，同时使用的代码和数据的库。`

比如常见的图形用户界面程序接口GUI（很多现代操作系统都提供GUI）

![image-20221101215252540](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101215252540.png)

**易懵概念:系统调用=系统调用命令=广义指令**

##### （3）作为扩充机器（虚拟机）

> 需要实现对硬件机器的拓展
>
> 没有任何软件支持的计算机成为裸机。在裸机上安装的操作系统，可以提供资源管理功能和方便用户的服务功能，将裸机改造成功能更强、使用更方便的机器
>
> 通常把覆盖了软件的机器成为扩充机器，又称之为虚拟机

![image-20221101215418538](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101215418538.png)

- 没有任何软件支持的计算机称为`裸机`
- 覆盖了软件的机器称为`扩充机器或虚拟机`

![image-20221101215501247](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221101215501247.png)

> 类比汽车：
>
> 发动机——只会转；轮胎——只会滚；
>
> 在原始的硬件机器上覆盖一层传动系统——让发动机带着轮子转——使原始的硬件机器得到拓展
>
> 操作系统对硬件机器的拓展：将CPU、内存、磁盘、显示器、键盘等硬件合理地组织起来，让各种硬件
>
> 能够相互协调配合，实现更多更复杂的功能
>
> 普通用户无需关心这些硬件在底层是怎么组织起来工作的，只需直接使用操作系统提供的接口即可

### 1.2 操作系统的特征（并发、共享、虚拟、异步）

操作系统是一种系统软件，但与其它系统软件和应用软件有很大的不同，它有自己的特殊性，及基本特征。

![image-20221109140312134](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109140312134.png)

#### 并发

- 并发：两个或多个事件在同一时间间隔内发生，这些事件在宏观上是同时发生的，在微观上是交替发生的， 操作系统的并发性指系统中同时存在着多个运行的程序

- 并行：两个或多个事件在同一时刻发生

- 一个单核(CPU)同一时刻只能执行一个程序，因此操作系统会协调多个程序使他们交替进行（这些程序在宏观上是同时发生的，在微观上是交替进行的）

- 操作系统是伴随着“多道程序技术出现的”，因此操作系统和并发是一同诞生的

- 在如今的计算机中，一般都是多核cpu的，即在同一时刻可以并行执行多个程序，比如我的计算机是8核的，我的计算机可以在同一时刻并行执行8个程序，但是事实上我们计算机执行的程序并不止8个，因此并发技术是必须存在的，并发性必不可少。

  ![image-20221109140533185](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109140533185.png)

**并发 VS 并行**

eg：假设小渣和老渣每人有两个女朋友。任务1：和一号约会；任务2：和二号约会...

![image-20221109140846561](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109140846561.png)

> 注意（重要考点）：
>
> 单核CPU同一时刻只能执行一个程序，各个程序只能并发地执行
>
> 多核CPU同一时刻可以同时执行多个程序，多个程序可以并行地执行
>
> 比如Intel 的第八代 i3 处理器就是 4 核CPU，意味着可以并行地执行4个程序
>
> 即使是对于4核CPU来说，只要有4个以上的程序需要“同时”运行，那么并发性依然是必不可少的，因此并发性是操作系统一个最基本的特性

#### 共享

- 资源共享即共享，是指系统中的资源可以`供内存中多个并发执行的进程`共同使用
- 共享分为两类：互斥共享和同时共享

##### 互斥共享

- 计算机中的某个资源在一段时间内只能允许一个进程访问，别的进程没有使用权
- 临界资源(独占资源)：在一段时间内只允许一个进程访问的资源，计算机中大多数物理设备及某些软件中的栈、变量和表格都属于临界资源，它们被要求互斥共享
- 举个例子：比如QQ和微信视频。同一段时间内摄像头只能分配给其中一个进程

##### 同时共享

- 计算机中的某个资源在在一段时间内可以同时允许多个进程访问
- 同时共享通常要求一个请求分为几个时间片段间隔的完成，即交替进行，“分时共享”
- 这里的同时指在宏观上是同时的，在微观上是交替进行访问的，只是cpu处理速度很快，我们感觉不到，在宏观上感觉是在同时进行
- 举个例子：比如QQ在发送文件A，微信在发送文件B，宏观上两个进程A和B都在访问磁盘，在我们看来是同时进行的，但是在微观上两个进程A和B是交替进行访问磁盘的，只是时间太短，cpu处理速度太快，我们感觉不到。
- 注意：有时候多个进程可能真的是在同时进行资源访问，比如玩游戏时可以放音乐，游戏声音和音乐声音都能听见

##### 并发性和共享性互为存在条件

![image-20221109141634426](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109141634426.png)

#### 虚拟

> 多道程序设计：是指在计算机内存中同时存放几道相互独立的程序，使它们在管理程序控制之下，相互穿插的运行。 两个或两个以上程序在计算机系统中同处于开始到结束之间的状态。这就称为多道程序设计。多道程序技术运行的特征：多道、宏观上并行、微观上串行。

- 虚拟是把一个物理上的实体变为若干逻辑上的对应物。
- 物理实体（前者）是实际存在的；而后者是虚的，是用户感觉上的事务
- 虚拟技术：用于实现虚拟的技术
- 虚拟处理器（CPU）：通过多道程序设计技术，采用让多道程序并发执行的方法，分时来使用一个CPU，实际物理上只有一个CPU，但是用户感觉到有多个CPU
- 虚拟存储器：从逻辑上扩充存储器容量，用户感觉到的但实际不存在的存储器
- 虚拟设备：将一台物理设备虚拟为逻辑上的多台设备，使多个用户在同一时间段内访问同一台设备，即同时共享，用户宏观上感觉是同时的，但实际上是微观交替访问同一台设备的
- 操作系统的虚拟技术科归纳为：
  - 时分复用技术：如处理器的分时共享
  - 空间复用技术：如虚拟存储器

![image-20221109142003948](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109142003948.png)

eg1：

背景知识：一个程序需要放入内存并给它分配CPU才能执行

GTA5需要4GB的运行内存，QQ 需要256MB的内存，迅雷需要256MB的内存，网易云音乐需要256MB的内存……

我的电脑：4GB内存问题：这些程序同时运行需要的内存远大于4GB，那么为什么它们还可以在我的电脑上同时运行呢？

答：这是虚拟存储器技术。实际只有4GB的内存，在用户看来似乎远远大于4GB

eg2：

背景知识：一个程序需要放入内存并给它分配CPU才能执行

某单核CPU的计算机中，用户打开了以下软件。。。QQ、谷歌浏览器、腾讯视频。。。

问题：既然一个程序需要被分配CPU才能正常执行，那么为什么单核CPU的电脑中能同时运行这么多个程序呢？

答：这是虚拟处理器技术。实际上只有一个单核CPU，在用户看来似乎有6个CPU在同时为自己服务

#### 异步

- 异步：多道程序环境允许多个程序并发执行，但由于资源有限，如cpu只有一个，进程的执行并不是一贯到底的，而是走走停停的，它以不可预知的速度向前推进。

- 比如A进程正在占用CPU计算，B进程这时也想占用CPU计算，B进程只有等，等A进程算完了，A进程去访问磁盘资源了，这时B进程再占用CPU进行计算，B进程还没计算完，A进程从磁盘取出资源了，A进程发现B这时在占用CPU，这时A进程就需要等待，等B算完后再继续到CPU中进行计算。由于每个进程占用资源的时间不固定，所以进程的执行以不可预知的速度前进

  ![image-20221109142411872](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109142411872.png)

## 2.操作系统的发展和分类

### 2.1 操作系统的发展和分类（手工、单道/多道批处理、分时、实时、网络、分布式、嵌入式、个人计算机）

xmind+processon

## 3.操作系统的运行机制和体系结构

### 3.1 操作系统的运行机制和体系结构（大内核、小内核）

![image-20221109150525907](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109150525907.png)

典型的大内核/宏内核/单内核 操作系统： Linux、UNIX

典型的 微内核 操作系统： Windows NT

#### 1.操作系统的运行机制和体系结构

xmind

#### 2.操作系统内核在计算机系统中的层次结构

![image-20221109150639940](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109150639940.png)

内核是操作系统最基本、最核心的部分。

实现操作系统内核功能的那些程序就是内核程序。

![image-20221109150821089](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109150821089.png)

![image-20221109150839232](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109150839232.png)

注意：

操作系统`内核`需要运行在`内核态`

操作系统的`非内核`功能运行在`用户态`

![image-20221109150928675](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109150928675.png)

一个故事：现在，应用程序想要请求操作系统的服务，这个服务的处理同时涉及到进程管理、存储管理、设备管理

注意：`变态的过程是有成本的`，要消耗不少时间，`频繁地变态会降低系统性能`

#### 3.操作系统体系结构类比

![image-20221109143454118](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109143454118.png)

#### 4.操作系统用户态和核心态的转换

![image-20221109143522476](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109143522476.png)

### 3.2 中断和异常（内中断和外中断、中断处理过程）

xmind

![image-20221109143849134](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109143849134.png)

#### 中断的作用

"中断"会使CPU由用户态变为内核态，使操作系统重新夺回对CPU的控制权

CPU 上会运行两种程序，一种是操作系统内核程序(是整个系统的管理者)，一种是应用程序

在合适的情况下，操作系统内核会把CPU的使用权主动让给应用程序（第二章进程管理相关内容）

“中断”是**让操作系统内核夺回CPU使用权**的唯一途径

如果没有“中断”机制，那么一旦应用程序上CPU运行，CPU就会一直运行这个应用程序

`内核态`->`用户态`：执行一条`特权指令`——`修改PSW`的标志位为“用户态”，这个动作意味着操作系统

将主动让出CPU使用权

`用户态`->`内核态`：由`“中断”`引发，`硬件自动完成变态过程`，触发中断信号意味着操作系统将强行夺

回CPU的使用权

#### 中断的类型

![image-20221109144517708](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109144517708.png)

##### 内中断（与当前执行的指令`有关`，中断信号来源于CPU`内部`）

![image-20221109144420316](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109144420316.png)

![image-20221109144434638](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109144434638.png)

##### 外中断（与当前执行的指令`无关`，中断信号来源于CPU`外部`）

![image-20221109144452435](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109144452435.png)

#### 中断机制的基本原理

**不同的中断信号，需要用不同的中断处理程序来处理。**当CPU检测到中断信号后，会根据中断信号的类型去查询“`中断向量表`”，以此来找到相应的中断处理程序在内存中的存放位置。

![image-20221109144557863](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109144557863.png)

### 3.3 系统调用（执行过程、访管指令、库函数与系统调用）

xmind

![image-20221109144925880](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109144925880.png)

#### 什么是系统调用

操作系统作为用户和计算机硬件之间的接口，需要向上提供一些简单易用的服务。主要包括命令接口和程序接口。其中，程序接口由一组系统调用组成。

![image-20221109145111611](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109145111611.png)

“系统调用”是操作系统提供给应用程序（程序员/编程人员）使用的接口，可以理解为一种可供应用程序调用的特殊函数，**应用程序可以通过系统调用来请求获得操作系统内核的服务**

#### 系统调用和库函数的区别

![image-20221109145203032](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109145203032.png)

#### 为什么系统调用是必须的？

生活场景：去学校打印店打印论文，你按下了 WPS 的“打印”选项，打印机开始工作。

你的论文打印到一半时，另一位同学按下了 Word 的“打印”按钮，开始打印他自己的论文。

思考：如果两个进程可以随意地、并发地共享打印机资源，会发生什么情况？

两个进程并发运行，打印机设备交替地收到 WPS 和 Word 两个进程发来的打印请求，结果两篇论文的内容混杂在一起了…

解决方法：由操作系统内核对共享资源进行统一的管理，并向上提供“系统调用” ，用户进程想要使用打印机这种共享资源，只能通过系统调用向操作系统内核发出请求。内核会对各个请求进行协调处理。

#### 什么功能要用到系统调用？

应用程序通过`系统调用`请求操作系统的服务。而系统中的各种共享资源都由操作系统内核统一掌管，因此`凡是与共享资源有关的操作（如存储分配、I/O操作、文件管理等），都必须通过系统调用的方式向操作系统内核提出服务请求`，由操作系统内核代为完成。这样`可以保证系统的稳定性和安全性`，防止用户进行非法操作。

![image-20221109145516473](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109145516473.png)

#### 系统调用的过程

![image-20221109145616244](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109145616244.png)

![image-20221109150231736](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109150231736.png)

传递系统调用参数->执行陷入指令（`用户态`）->执行相应的内请求核程序处理系统调用（`核心态`）->返回应用程序

注意：

1. `陷入指令`是在`用户态`执行的，执行陷入指令之后立即引发一个`内中断`，使CPU`进入核心态`

2. `发出系统调用请求`是在`用户态`，而`对系统调用的相应处理`在`核心态`下进行
3. 陷入指令是唯一一个只能在用户态执行，而不可在核心态执行的指令

## 第1章知识回顾

![image-20221109153907140](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109153907140.png)

![image-20221109154135148](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109154135148.png)

![image-20221109154155284](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109154155284.png)

![image-20221109154206315](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109154206315.png)

![image-20221109154220177](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109154220177.png)

![image-20221109154234077](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109154234077.png)

![image-20221109154246599](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109154246599.png)

![image-20221109154315237](https://gitee.com/kiteflyer/picture/raw/master/OS/image-20221109154315237.png)

